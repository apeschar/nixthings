#!/usr/bin/env bash

set -euo pipefail
cd "$(dirname "$0")/.."

mkdir -p etc

out=etc/github-known-hosts
tmp=$out.$(tr -dc 'a-zA-Z0-9' < /dev/urandom | head -c 16 || true)
cleanup() { rm -f $tmp; }
trap cleanup EXIT

curl -L \
  -H "Accept: application/vnd.github+json" \
  -H "X-GitHub-Api-Version: 2022-11-28" \
  https://api.github.com/meta |
jq -r '.ssh_keys[] | "github.com " + .' > $tmp

mv $tmp $out
